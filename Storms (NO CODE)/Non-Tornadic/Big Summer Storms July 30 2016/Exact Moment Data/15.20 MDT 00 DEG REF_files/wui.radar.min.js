(function(a){if(!window.Backbone){return}wui.Views.RadarApp=Backbone.View.extend({initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.models.radblast=this.createRadblastModel();this.createViews();var b=this;wui.usher.loadAds();if(b.views.shareView){b.views.shareView.render()}var d=wui.bootstrapped.radar.page;if(d==="national"||d==="regional"){a(".radar-tour").on("click",function(f){b.initializeJoyride(false)})}if(wui.bootstrapped.radar.page==="national"){a(document).on("replace","img",function(j,f,i){var g=a("img[usemap]");var h="#nowradMap";g.attr("usemap",h+(f.indexOf("-small")>-1?"-small":""));g.rwdImageMaps()});a(window).on("unload",function(){a('select[name="region-links"]').prop("selectedIndex",0)})}this.startInitialization()},startInitialization:function(){this.viewLoaded=a.Deferred();var d=this;var c=[];var e=null;e=wui.usher.loadScript("mapbox");c.push(e);var b=null;b=wui.usher.loadScript("mosaicmap");c.push(b);a.when.apply(a,c).done(function(){d.continueInit()})},continueInit:function(){var b=this;var c=null;c=wui.usher.loadScript("mosaicwundermap");c.fail(function(f,d,e){console.log("mosaic wundermap failed")});c.done(function(f,d,e){b.finishInit()})},finishInit:function(){this.viewLoaded.resolve();this.rendermosaic()},rendermosaic:function(){if(wui.bootstrapped.radarstations.country=="au"){this.lat=-24;this.lon=134}else{if(wui.bootstrapped.radarstations.country=="ca"){this.lat=55;this.lon=-104.6}}var b={lat:this.lat,lon:this.lon,attribution:true,animationOptions:{animationControl:false},zoomOptions:{scrollWheelZoom:false,zoomControl:false,zoomLevel:4},layers:[{datalayer:"Nexrad",customClickHandler:function(c,f){var d=c.properties;if(d.id&&d.id!=stationid&&d.type=="ICAO"){window.location="/history/airport/"+d.id}else{if(d.id&&d.id!=stationid&&d.type=="BUOY"){window.location="/MAR/buoy/"+d.id.substring(4)+".html"}else{window.location="/personal-weather-station/dashboard?ID="+d.id}}},}]};mosaicmap.loadMap(b);if(mosaicmap.map.initialized==true&&wui.bootstrapped.prefs.radar){mosaicmap.map.move(wui.bootstrapped.prefs.radar.station_lat,wui.bootstrapped.prefs.radar.station_lon,5)}else{a(document).on("MosaicDone",mosaicmap.map.move(wui.bootstrapped.prefs.radar.station_lat,wui.bootstrapped.prefs.radar.station_lon,5))}return this},createViews:function(){this.views={};var b=null;b=a("#single-site-radar");if(b[0]){this.views.radblast=new wui.Views.Radblast({models:{radblast:this.models.radblast},el:b[0],render:true})}b=a("#save-link");if(b[0]){this.views.radblast_savelink=new wui.Views.RadblastSaveLink({models:{radblast:this.models.radblast},el:b[0]})}b=a("#rad-map-links");if(b[0]){this.views.radar_datepicker=new wui.Views.RadarDatePicker({models:{radblast:this.models.radblast},map:wui.bootstrapped.radar.map,el:b[0]})}b=a("#radblast .radblast-controls .viewport");if(b[0]){this.views.viewport=new wui.Views.Viewport({el:b[0],center:{x:this.models.radblast.get("station_x")||0,y:this.models.radblast.get("station_y")||0}});this.views.radarImagemap=new wui.Views.RadarImagemap({models:{radblast:this.models.radblast},el:b[0]})}b=a("#share");if(b[0]&&wui.bootstrapped.async){this.views.shareView=new wui.Views.Share({model:this.model,models:{weather:this.models.weather},el:b[0]})}},createRadblastModel:function(){var b=new wui.Models.Radblast(wui.bootstrapped.prefs.radar,{});return b},initializeJoyride:function(b){a(document).foundation("joyride","start",{abort_on_close:false,scroll_speed:500,tip_location_patterns:{top:["top"],bottom:["top"],left:["right","top","bottom"],right:["left","top","bottom"]},post_ride_callback:function(){if(wui.bootstrapped.radar.enableTour){wui.prefs.set("radarTour",1)}}})}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Models.Radblast=Backbone.NestedModel.extend({defaults:function(){return{station_id:"",station_lat:0,station_lon:0,station_x:0,station_y:0,product_range:124,num:1,delay:15,type:"",frame:0,scale:1,noclutter:0,showlabels:0,showstorms:0,smooth:1,rainsnow:1,lightning:0,mapx:400,mapy:240,centerx:400,centery:240,transx:0,transy:0,xoffset:170,yoffset:10,width:460,height:460,zoommode:"zoom",brand:"wui",domain:"",maxframes:6,update_interval:0,numFlag:1,isAnimatingFlag:false}},getURL:function(){var c=this.attributes;var b=c.domain+"/cgi-bin/radar/WUNIDS_map?";b+=a.param({station:c.station_id,brand:c.brand,num:c.numFlag,delay:c.delay,type:c.type,frame:c.frame,scale:c.scale,noclutter:c.noclutter,showstorms:c.showstorms,mapx:c.mapx,mapy:c.mapy,centerx:c.centerx,centery:c.centery,transx:c.transx,transy:c.transy,showlabels:c.showlabels,severe:0,rainsnow:c.rainsnow,lightning:c.lightning,smooth:c.smooth,rand:Math.floor((new Date()).getTime()/60000)});b+=c.params;return b}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.Radblast=Backbone.View.extend({events:{"click [data-name=type]":"onChangeSettingsButtongroup","click input[type=checkbox]":"onClickSettingsCheckbox","change select[name=type]":"onChangeSettingsSelect","change select[name=showstorms]":"onChangeSettingsSelect","change select[name=num]":"onChangeSettingsSelect","change select[name=delay]":"onChangeSettingsSelect","change select[name=scale]":"onChangeZoomSelect","click .change-frame-first":"changeFrameFirst","click .change-frame-previous":"changeFramePrevious","click .change-frame-next":"changeFrameNext","click .change-frame-last":"changeFrameLast","click .change-frame-play":"onClickPlay","click .change-frame-stop":"onClickStop","click .save-settings":"onClickSaveSettings"},initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$img=this.$el.find("img#radarmap");this.$imgSevere=this.$el.find("img#severemap");this.lastUpdate=null;this.imgAreaSelect=null;this.checkPlaybackButtons();this.checkResize();this.checkUpdate();this.listenTo(this.models.radblast,"change",this.render);this.listenTo(this.models.radblast,"change:type",this.onChangeType);this.listenTo(this.models.radblast,"change:frame",this.onChangeFrame);this.listenTo(this.models.radblast,"change:num",this.onChangeNum);this.listenTo(this.models.radblast,"change:scale",this.onChangeScale);this.listenTo(this.models.radblast,"change:severe",this.onChangeSevere);a(window).resize(a.proxy(this.onResize,this));if(this.options.render){this.render()}},changeFrame:function(c){var b=this.models.radblast.get("maxframes");if(c>b){c=b}if(c<0){c=0}this.models.radblast.set({frame:c,num:1,numFlag:1})},changeFrameFirst:function(){this.changeFrame(40)},changeFramePrevious:function(){var b=this.models.radblast.get("frame");b=(+b)+1;this.changeFrame(b)},changeFrameNext:function(){var b=this.models.radblast.get("frame");b=(+b)-1;this.changeFrame(b)},changeFrameLast:function(){this.changeFrame(0)},checkPlaybackButtons:function(){var f=+this.models.radblast.get("frame");var c=+this.models.radblast.get("num");var b=this.models.radblast.get("maxframes");var g=(f>=b);var e=(f<=0);var d="disabled";this.$el.find(".change-frame-first, .change-frame-previous").toggleClass(d,g);this.$el.find(".change-frame-next, .change-frame-last").toggleClass(d,e);this.toggleButton()},checkResize:function(){var c=a(window).width();var b=(c<640);var d=b?"horse":"wui";this.models.radblast.set("brand",d);if(this.imgAreaSelect){if(b){this.imgAreaSelect.setOptions({disable:true})}else{this.imgAreaSelect.setOptions({enable:true})}}else{if(b){}else{this.imgAreaSelect=this.createImgSelectArea()}}},checkSevere:function(){var c="normal";var b=+this.models.radblast.get("severe");if(b){this.renderSevere();this.$imgSevere.fadeTo(c,0.6)}else{this.$imgSevere.fadeTo(c,0)}},checkSevereLegend:function(){var c=this.$el.find("#severeKey");var b=+this.models.radblast.get("severe");if(b){c.show()}else{c.hide()}},checkUpdate:function(){var b=+this.models.radblast.get("update_interval")*1000;if(!b){return}var d=new Date();if(!this.lastUpdate){this.lastUpdate=d}if(d-this.lastUpdate>b){this.render()}var e=b-(d-this.lastUpdate);var f=Math.floor(e/1000);this.$el.find("#udtime").html(f);var c=1000;window.setTimeout(a.proxy(this.checkUpdate,this),c)},createImgSelectArea:function(){var c=this.$el.find("#plano");var d=this.$el.find(".radblast-imagery");c.css("background-color","#fff").css("opacity",0.001);var b=c.imgAreaSelect({aspectRatio:"1:1",handles:false,instance:true,minHeight:15,minWidth:15,maxHeight:c.width(),maxWidth:c.height(),movable:false,parent:d,resizable:false,onSelectEnd:a.proxy(this.onSelectEnd,this)});return b},getPrefs:function(){var c=this.models.radblast.attributes;var b={RADNUM:c.num,RADSPD:c.delay,RADC:c.noclutter,RADSTM:c.showstorms,SLABS:c.showlabels,RADRMS:c.rainsnow,RADLIT:(+c.lightning)?"Show":"Hide",RADSMO:c.smooth,RADPLAY:c.isAnimatingFlag};return b},getScaleSettings:function(n){var h=+n.mapx;var g=+n.mapy;var u=+n.centerx;var t=+n.centery;var l=+n.xoffset;var j=+n.yoffset;var s=+n.width;var p=+n.height;var r=n.zoommode;var q=+n.scale;var b=+n.rbscale;var m=0;var w=0,v=0;var e=0,d=0;var k=0,i=0;var c=0,z=0,o=0,f=0;if(b||b===0){m=n.rbscale;if(m<=0){m=0.125}}else{if(r=="zoom"){m=q-0.25;if(m<=0){m=0.125}}else{if(r=="pan"){m=q}else{if(r=="out"){if(q==0.125){m=0.25}else{m=q+0.25}}else{m=1}}}}if(q<=0||q>1){q=1}if(m<=0||m>1){m=1}w=(l+s/2);v=(j+p/2);e=u*(q/m)-(h*(q/m)-w);d=t*(q/m)-(g*(q/m)-v);k=e-(l+s/2);i=d-(j+p/2);c=k-(s/2/m-s/2);if(c>0){k-=c;e=k+(l+s/2)}z=-1*k-(s/2/m-s/2);if(z>0){k+=z;e=k+(l+s/2)}o=i-(p/2/m-p/2);if(o>0){i-=o;d=i+(j+p/2)}f=-1*i-(p/2/m-p/2);if(f>0){i+=f;d=i+(j+p/2)}return{centerx:e,centery:d,transx:k,transy:i,scale:m}},getURL:function(){return this.models.radblast.getURL()},getURLSevere:function(){var c=this.models.radblast.attributes;var k=parseFloat(c.centerx)-parseFloat(c.mapx);var b=parseFloat(c.centery)-parseFloat(c.mapy);var e=parseFloat(c.scale);var i=parseFloat(c.station_lat);var o=parseFloat(c.station_lon);var j=parseFloat(c.product_range);var f=i-j/60*e+b*e*(j/(60*230));var h=i+j/60*e+b*e*(j/(60*230));var m=o-(j/60*e+k*e*(j/(60*230)))/Math.cos(i*Math.PI/180);var n=o+(j/60*e-k*e*(j/(60*230)))/Math.cos(i*Math.PI/180);var l=this.models.radblast.get("width");var g=this.models.radblast.get("height");var d="//wumaps.wunderground.com/cgi-bin/mapgen?";d+=a.param({theme:"severe",stdout:1,size:l+"x"+g,minlat:f,minlon:m,maxlat:h,maxlon:n,format:"gif",alpha:1});return d},onChangeFrame:function(b,c){this.checkPlaybackButtons()},onChangeNum:function(c,b){this.checkPlaybackButtons();this.$el.find("select[name=num]").val(b)},onChangeZoomSelect:function(f){var c=a(f.target);var g=c.val();var d=a.extend(true,{},this.models.radblast.attributes,{rbscale:g});var b=this.getScaleSettings(d);this.models.radblast.set(b)},onChangeScale:function(d,i){var c=this.$el.find("select[name=scale]");var h=c.find('option[value="'+i+'"]');var b=h.index();if(b<0){var g="scale-custom";var f=100/i;var e=""+f.toFixed(0)+"%";h=c.find("option."+g);if(!h[0]){h=a("<option />").addClass(g);h.appendTo(c)}h.attr("value",i).html(e);b=c[0].options.length-1}c[0].selectedIndex=b},onChangeSevere:function(b,c){this.checkSevere();this.checkSevereLegend()},onChangeSettingsButtongroup:function(f){f.preventDefault();var b=a(f.target);var c=b.attr("data-name");var d=b.attr("data-value");this.models.radblast.set(c,d)},onChangeSettingsSelect:function(d){var b=d.target.name;var c=a(d.target).val();if(b=="num"){this.models.radblast.set("numFlag",c);this.models.radblast.set("isAnimatingFlag",true)}this.models.radblast.set(b,c)},onChangeType:function(b,c){this.$el.find("select[name=type]").val(c);if(c!=="NTP"){c="N0R"}var d=this.$el.find(".button[data-name=type][data-value="+c+"]");if(wui.wuForm&&wui.wuForm.buttonGroup){wui.wuForm.buttonGroup.select(d[0])}},onClickSaveSettings:function(b){b.preventDefault();this.setPrefs()},onClickSettingsCheckbox:function(f){var c=f.target.checked;var b=f.target.name;var d=c?1:0;this.models.radblast.set(b,d)},onClickPlay:function(b){b.preventDefault();this.play()},onClickStop:function(b){b.preventDefault();this.stop()},onLoadImg:function(b){if(this.imgAreaSelect){this.imgAreaSelect.cancelSelection()}},onResize:function(b){this.checkResize()},onSelectEnd:function(d,o){var h=this.models.radblast.get("xoffset");var n=this.models.radblast.get("yoffset");var k=this.models.radblast.get("zoommode");var i=this.models.radblast.get("scale");var l;var c=o.width;var p=o.height;var g=o.x1+c/2+h;var f=o.y1+p/2+n;if(k=="pan"){l=i}else{if(k=="out"){l=i+0.25}else{if(c<5&&p<5){l=i/2}else{if(c>p){var m=this.models.radblast.get("width");l=i*c/m}else{var j=this.models.radblast.get("height");l=i*p/j}}}}if(l>1){l=1}if(l<0.125){l=0.125}var b=a.extend(true,{},this.models.radblast.attributes,{mapx:g,mapy:f,rbscale:l});var e=this.getScaleSettings(b);this.models.radblast.set(e)},play:function(){var b=+this.models.radblast.get("num");this.models.radblast.set({frame:0,num:b,numFlag:b,isAnimatingFlag:true});this.toggleButton()},render:function(c,g){var b=this.getURL();var h=this;if(b!=this.$img.attr("src")){var f=a("<img>",{src:b,"class":this.$img.attr("class")+" loading"});var d=a.proxy(function(){f.off("load.radblast");clearTimeout(e);this.$img.remove();this.$img=f;this.$img.attr({id:"radarmap"}).removeClass("loading");h.$el.find("#save-radar-image").attr("href",this.$img.attr("src"));this.onLoadImg()},this);var e=setTimeout(d,3000);f.on("load.radblast",d);f.insertAfter(this.$img)}this.checkSevere();this.lastUpdate=new Date();if(a("#storm-table").length){a("#storm-table").table().data("table").refresh()}return this},renderSevere:function(){var b=this.getURLSevere();this.$imgSevere.attr("src",b)},setPrefs:function(){var b=this.getPrefs();wui.prefs.setMany(b)},stop:function(){var b=+this.models.radblast.get("num");this.models.radblast.set({frame:0,numFlag:1,num:b,isAnimatingFlag:false});this.toggleButton()},toggleButton:function(){var c="hide";var b=this.models.radblast.get("isAnimatingFlag");this.$el.find(".change-frame-play").toggleClass(c,b);this.$el.find(".change-frame-stop").toggleClass(c,!b)}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.Viewport=Backbone.View.extend({events:{},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.$viewport=this.$el;this.$viewportContent=this.$viewport.find(".viewport-content").eq(0);if(this.options.draggable){this.setupDraggable()}this.checkCenter();var b=1000;var e=_.bind(this.onResize,this);var d=_.throttle(e,b);a(window).on("resize",d)},calculateContainment:function(){var f=this.$viewport.offset().left+parseFloat(this.$viewport.css("border-left-width"));var e=this.$viewport.offset().top+parseFloat(this.$viewport.css("border-top-width"));var j=this.$viewport.width()-this.$viewportContent.outerWidth();var i=this.$viewport.height()-this.$viewportContent.outerHeight();var d=f+(j<0?j:0);var h=e+(i<0?i:0);var c=f;var g=e;var b=[d,h,c,g];return b},checkCenter:function(){if(this.options.center){this.setCenter(this.options.center.x,this.options.center.y)}},onResize:function(b){if(this.options.draggable){this.updateContainment()}this.checkCenter()},setCenter:function(b,c){if(this.options.draggable){this.setCenterOfDraggable(b,c)}else{this.setCenterOfScrollableDiv()}},setCenterOfDraggable:function(c,i){var d=this.$viewport.width();var b=this.$viewport.height();var g=d/2-c;var f=b/2-i;var h=d-this.$viewportContent.outerWidth();var e=b-this.$viewportContent.outerHeight();g=wui.limit(g,h,0);f=wui.limit(f,e,0);this.$viewportContent.css({left:g,top:f})},setCenterOfScrollableDiv:function(){var b=a("#radar-station-markers").find(".active");var c=b.position().top-(this.$viewport.height()-b.height())/2;var d=b.position().left-(this.$viewport.width()-b.width())/2;this.$viewport.scrollTop(c+parseInt(b.css("marginTop"),10));this.$viewport.scrollLeft(d+parseInt(b.css("marginLeft"),10))},setupDraggable:function(){this.$viewportContent.draggable({scroll:false});this.updateContainment()},updateContainment:function(){var b=this.calculateContainment();this.updateDraggable({containment:b})},updateDraggable:function(b){this.$viewportContent.draggable("option",b)}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.RadarImagemap=Backbone.View.extend({initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.$imagemapLink=this.$el.find("img[ismap]").closest("a",this.el);this.$imagemapLink.find("img[ismap]").removeAttr("ismap");this.$imagemapLink.click(a.proxy(this.onClick,this));if(this.models.radblast){this.positionCurrent()}},onClick:function(g){g.preventDefault();var f=this.$imagemapLink;var b=Math.round(g.pageX-f.offset().left);var i=Math.round(g.pageY-f.offset().top);var h={map_x:b,map_y:i};var d="";if(d){h.type=d}var c=f.attr("href")+"?"+a.param(h);window.location=c},positionCurrent:function(){var e=this.$el.find("#nexradclick_current");var d=13;var c=13;var b=this.models.radblast.get("station_x");var f=this.models.radblast.get("station_y");e.css({position:"absolute",left:(b-Math.floor(d/2)),top:(f-Math.floor(c/2))})}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.RadarMapselector=Backbone.View.extend({initialize:function(b){this.options=a.extend(true,{brand:"wundermap",country:"",draggable:true,dragRefresh:false,icon:{src:"//icons.wxug.com/graphics/radkey_nexrad.gif",width:13,height:13},lat:null,lon:null,maxbounds:true,selectedIcon:{src:"//icons.wxug.com/graphics/radkey_current.gif",width:13,height:13},stations:[],type:"00Q",zoom:4},b);this.models=this.options.models||{};if(!this.options.stations||!this.options.stations.length){var g=this.options.country;var h=wui.bootstrapped.radarstations[g];if(h&&h.length){this.options.stations=h}}if(this.options.lat===null){var e=this.models.radblast.get("station_id");if(e){var d=_.findWhere(this.options.stations,{id:e});if(d){this.options.lat=d.lat;this.options.lon=d.lon}}}this._map=null;this._maxbounds=null;this._overlay=null;this._regularIcon=null;var c=this;var f=wui.usher.loadScript("googlemaps");f.done(function(){c.createMaxBounds();c.createMap()})},createMaxBounds:function(){var b=null;if(this.options.maxbounds===true){var d=this.options.country;var c=this.getBounds(d);b=new google.maps.LatLngBounds(new google.maps.LatLng(c.minlat,c.minlon),new google.maps.LatLng(c.maxlat,c.maxlon))}else{if(this.options.maxbounds){b=this.options.maxbounds}}this._maxbounds=b;return b},createMap:function(j){var e=a.extend(true,{},this.options,j);var h=this._maxbounds;var g=null;var c=new google.maps.LatLng(e.lat,e.lon);var b={backgroundColor:"#1C3575",center:c,disableDoubleClickZoom:true,draggable:e.draggable,keyboardShortcuts:false,mapTypeId:null,mapTypeControl:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:false,scaleControl:false,scrollwheel:false,streetViewControl:false,zoom:e.zoom};var d=new google.maps.Map(this.el,b);var i=this;var f=new google.maps.OverlayView();f.draw=f.onAdd=f.onRemove=function(){};f.setMap(d);google.maps.event.addListenerOnce(d,"bounds_changed",function(){if(h){var l=0;var p=0;var m=i.$el.width();var k=i.$el.height();var o=f.getProjection().fromLatLngToContainerPixel(h.getNorthEast());var n=f.getProjection().fromLatLngToContainerPixel(h.getSouthWest());if(o.y>0){p=o.y+1}else{if(n.y<k){p=n.y-k-1}}if(n.x>0){l=n.x+1}else{if(o.x<m){l=o.x-m-1}}d.panBy(l,p);c=d.getCenter()}i.addStations(e.stations)});if(e.dragRefresh){google.maps.event.addListener(d,"idle",function(){var k=g;var l=i.drawImage();window.setTimeout(function(){if(k){k.setMap(null)}},10*1000);g=l})}else{google.maps.event.addListenerOnce(d,"idle",function(){g=i.drawImage()})}if(h){google.maps.event.addListener(d,"drag",function(){var k=d.getBounds();if(h.contains(k.getSouthWest())&&h.contains(k.getNorthEast())){c=d.getCenter()}else{d.setCenter(c)}})}this._map=d;this._overlay=f},drawImage:function(){var e=this._map;var b=this._maxbounds;var d=e.getBounds();if(b&&b.toSpan().lat()>d.toSpan().lat()){d=b}var f=this.getURL(d);var c=new google.maps.GroundOverlay(f,d,{clickable:false,map:e});return c},getBounds:function(c){var b=null;if(c=="au"){b={minlat:-44.76,minlon:112.37,maxlat:-7.95,maxlon:168.62}}else{if(c=="ca"){b={minlat:41.7,minlon:-141.5,maxlat:70,maxlon:-53.3}}}return b},getURL:function(d){var f=this._overlay.getProjection().fromLatLngToDivPixel(d.getNorthEast());var c=this._overlay.getProjection().fromLatLngToDivPixel(d.getSouthWest());var e={maxlat:d.getNorthEast().lat(),maxlon:d.getNorthEast().lng(),minlat:d.getSouthWest().lat(),minlon:d.getSouthWest().lng(),type:this.options.type,frame:0,num:0,width:f.x-c.x,height:c.y-f.y,png:0,smooth:1,min:2,noclutter:0,rainsnow:1,timelabel:1,brand:this.options.brand,newmaps:1,rand:Math.floor(new Date().getTime()/60000)};var b="//radblast.wunderground.com/cgi-bin/radar/WUNIDS_composite?"+a.param(e);return b},getURLStation:function(d){var b="/radar/radblast.asp?ID="+d.id;var c=this.models.radblast.get("type");if(c){b+="&type="+c}return b},addStation:function(i){var g=null;var k=this.options;var c=this.models.radblast.get("station_id");var j=this;var b=this._map;var d=this._overlay;if(c&&c===i.id){g=new google.maps.MarkerImage(k.selectedIcon.src,new google.maps.Size(k.selectedIcon.width,k.selectedIcon.height),new google.maps.Point(0,0),new google.maps.Point(k.selectedIcon.width/2,k.selectedIcon.height/2))}else{if(!this._regularIcon){this._regularIcon=new google.maps.MarkerImage(k.icon.src,new google.maps.Size(k.icon.width,k.icon.height),new google.maps.Point(0,0),new google.maps.Point(k.icon.width/2,k.icon.height/2))}g=this._regularIcon}var f=new google.maps.LatLng(i.lat,i.lon);if(i.offsetx||i.offsety){var h=d.getProjection().fromLatLngToDivPixel(f);h.x+=i.offsetx;h.y+=i.offsety;f=d.getProjection().fromDivPixelToLatLng(h)}var e=new google.maps.Marker({clickable:true,draggable:false,icon:g,map:b,position:f,raiseOnDrag:false,title:i.name});google.maps.event.addListener(e,"click",function(){var l=j.getURLStation(i);window.location=l})},addStations:function(d){for(var c=0,b=d.length;c<b;c++){this.addStation(d[c])}}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.RadblastSaveLink=Backbone.View.extend({events:{},initialize:function(b){this.options=b||{};this.models=this.options.models||{};this.listenTo(this.models.radblast,"change",this.render)},render:function(b,c){this.$el.attr("href",this.models.radblast.getURL());return this}})})(jQuery);(function(a){if(!window.Backbone){return}wui.Views.RadarDatePicker=Backbone.View.extend({events:{"click #radar-cal-button":"onClickButton","click #radar-date-touch .radar-date-confirm":"onClickConfirm","click #radar-date-touch .radar-date-cancel":"onClickCancel",},initialize:function(c){this.options=c||{};this.models=this.options.models||{};this.options.map=this.options.map||{};this.$datepicker=null;if(Modernizr&&Modernizr.touch){var d=this.$el.find("#radar-date-touch input[type=date]");var b=new Date(d.val());if(b==="Invalid Date"){b=new Date()}b=wui.date.decrement(b,1,"day");d.val(wui.date.strftime("%Y-%m-%d",b))}},initializeDatepicker:function(){if(this.$datepicker){return}var b=this;var c=this.$el.find("#radar-cal-panel");c.removeClass("none");this.$datepicker=this.$el.find("#radar-cal");this.$datepicker.datepicker({dateFormat:"yy-mm-dd",minDate:new Date("1/1/1994"),maxDate:0,nextText:"",prevText:"",onChangeMonthYear:function(){event.stopPropagation()},onSelect:function(f,d){var e=b.getLinkURL(f);location.href=e},showAnim:""});c.on("closed",a.proxy(this.resetButtonGroup,this))},getLinkURL:function(d){var c=this.options;var b="/wundermap/?"+a.param({lat:c.map.lat,lon:c.map.lon,zoom:c.map.zoom,date:d,time:"00:00","tl.play":1,"tl.spd":2,"tl.dur":24,"tl.mode":"advanced"});b+="&rad=1&wxsn=0&svr=0&cams=0&sat=0&riv=0&mm=0&hur=0";return b},onClickButton:function(b){b.preventDefault();if(Modernizr&&Modernizr.touch){this.toggleRadarTouch(true)}else{this.initializeDatepicker()}},onClickCancel:function(b){b.preventDefault();this.toggleRadarTouch(false);this.resetButtonGroup()},onClickConfirm:function(b){b.preventDefault();this.radarTouchConfirm()},radarTouchConfirm:function(){var d=this.$el.find("#radar-date-touch input[type=date]");var c=d.val();var b=this.getLinkURL(c);location.href=b},resetButtonGroup:function(){var b=this.$el.find("#radar-hist-links").find("li.button");this.$el.find("#radar-cal-button").removeClass("selected");this.$el.find("#radar-cal-panel").removeClass("selected");b.addClass("selected")},toggleRadarTouch:function(b){var c=this.$el.find(".cube-container");c.toggleClass("selected",!!b);a(".hide-for-touch-date").show();a(".show-for-touch-date").hide();if(!!b){a(".hide-for-touch-date").hide();a(".show-for-touch-date").show()}}})})(jQuery);(function(d,c,b,e){var a=Foundation.libs.joyride;d.extend(true,a,{defaults:{tip_offset_x:0,tip_offset_y:0}});a.pos_default=function(n,k){var m=Math.ceil(d(c).height()/2),l=this.settings.$next_tip.offset(),i=this.settings.$next_tip.find(".joyride-nub"),f=Math.ceil(i.outerWidth()/2),j=Math.ceil(i.outerHeight()/2),h=n||false;if(h){this.settings.$next_tip.css("visibility","hidden");this.settings.$next_tip.show()}if(typeof k==="undefined"){k=false}if(!/body/i.test(this.settings.$target.selector)){if(this.bottom()){var g=this.settings.$target.offset().left;if(Foundation.rtl){g=this.settings.$target.offset().width-this.settings.$next_tip.width()+g}this.settings.$next_tip.css({top:(this.settings.$target.offset().top+j+this.settings.$target.outerHeight()+this.settings.tip_settings.tip_offset_y),left:(g+this.settings.tip_settings.tip_offset_x)});this.nub_position(i,this.settings.tip_settings.nub_position,"top")}else{if(this.top()){var g=this.settings.$target.offset().left;if(Foundation.rtl){g=this.settings.$target.offset().width-this.settings.$next_tip.width()+g}this.settings.$next_tip.css({top:(this.settings.$target.offset().top-this.settings.$next_tip.outerHeight()-j+this.settings.tip_settings.tip_offset_y),left:(g+this.settings.tip_settings.tip_offset_x)});this.nub_position(i,this.settings.tip_settings.nub_position,"bottom")}else{if(this.right()){this.settings.$next_tip.css({top:(this.settings.$target.offset().top+this.settings.tip_settings.tip_offset_y),left:(this.outerWidth(this.settings.$target)+this.settings.$target.offset().left+f+this.settings.tip_settings.tip_offset_x)});this.nub_position(i,this.settings.tip_settings.nub_position,"left")}else{if(this.left()){this.settings.$next_tip.css({top:(this.settings.$target.offset().top+this.settings.tip_settings.tip_offset_y),left:(this.settings.$target.offset().left-this.outerWidth(this.settings.$next_tip)-f+this.settings.tip_settings.tip_offset_x)});this.nub_position(i,this.settings.tip_settings.nub_position,"right")}}}}if(!this.visible(this.corners(this.settings.$next_tip))&&this.settings.attempts<this.settings.tip_settings.tip_location_pattern.length){i.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left");this.settings.tip_settings.tip_location=this.settings.tip_settings.tip_location_pattern[this.settings.attempts];this.settings.attempts++;this.pos_default()}}else{if(this.settings.$li.length){this.pos_modal(i)}}if(h){this.settings.$next_tip.hide();this.settings.$next_tip.css("visibility","visible")}}}(jQuery,this,this.document));